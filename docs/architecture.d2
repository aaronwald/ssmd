direction: right

exchanges: Exchanges {
  kalshi: Kalshi WebSocket
}

capture: Data Capture {
  style.fill: "#fff3e0"
  connector: ssmd-connector {
    shape: rectangle
    style.fill: "#e3f2fd"
  }
  nats: NATS JetStream {
    shape: cylinder
    style.fill: "#ffecb3"
  }
  archiver: ssmd-archiver {
    shape: rectangle
    style.fill: "#e3f2fd"
  }

  connector -> nats: prod.kalshi.>
  nats -> archiver
}

refdata: Reference Data {
  style.fill: "#e8f5e9"
  cli: ssmd CLI {
    shape: rectangle
    style.fill: "#c8e6c9"
  }
  postgres: PostgreSQL {
    shape: cylinder
    style.fill: "#a5d6a7"
  }
  api: ssmd-data-ts {
    shape: rectangle
    style.fill: "#c8e6c9"
  }

  cli -> api: HTTP API
  api -> postgres
}

runtime: Signal Runtime {
  style.fill: "#e1f5fe"
  runner: ssmd signal run {
    shape: rectangle
    style.fill: "#b3e5fc"
  }
}

agent: Agent (ssmd-agent) {
  style.fill: "#f3e5f5"
}

git: Git {
  shape: cylinder
  style.fill: "#ffebee"
}

exchanges -> capture
exchanges -> refdata.cli: Kalshi API
capture.nats -> runtime.runner: subscribe
runtime.runner -> capture.nats: signals.*.fires
refdata -> agent: {style.stroke-dash: 3}
capture -> agent: {style.stroke-dash: 3}
agent -> git
