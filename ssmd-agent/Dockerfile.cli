# ssmd-cli: TypeScript CLI for market data operations
FROM denoland/deno:2.1.4

WORKDIR /app

# Copy only necessary files for the CLI
COPY deno.json ./
COPY src/cli/ ./src/cli/
COPY src/lib/ ./src/lib/
COPY src/backtest/ ./src/backtest/

# Cache dependencies first
RUN deno cache src/cli/main.ts

# Compile to standalone binary for easy distribution
RUN deno compile --allow-net --allow-env --allow-read --allow-write --allow-run \
    --output /usr/local/bin/ssmd src/cli/main.ts

# Create non-root user for security
USER deno

# Set up the CLI entrypoint (can use either compiled binary or deno run)
ENTRYPOINT ["/usr/local/bin/ssmd"]
